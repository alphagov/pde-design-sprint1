/*! Ideal Postcodes jQuery Plugin - v2.2.0 - 2014-11-17
* https://github.com/ideal-postcodes/jquery.postcodes
2014 Ideal Postcodes; Licensed MIT */
!function(a){"use strict";function b(b){this.config={},a.extend(this,e),b&&a.extend(this,b);var c={};for(var d in this.output_fields)void 0!==this.output_fields[d]&&(c[d]=a(this.output_fields[d]));this.$output_fields=c}var c=[],d={},e={api_key:"",output_fields:{line_1:"#line_1",line_2:"#line_2",line_3:"#line_3",post_town:"#post_town",postcode:"#postcode",postcode_inward:void 0,postcode_outward:void 0,udprn:void 0,dependant_locality:void 0,double_dependant_locality:void 0,thoroughfare:void 0,dependant_thoroughfare:void 0,building_number:void 0,building_name:void 0,sub_building_name:void 0,po_box:void 0,department_name:void 0,organisation_name:void 0,postcode_type:void 0,su_organisation_indicator:void 0,delivery_point_suffix:void 0},api_endpoint:"https://api.ideal-postcodes.co.uk/v1",input:void 0,$input:void 0,input_label:"Please enter your postcode",input_muted_style:"color:#CBCBCB;",input_class:"",input_id:"idpc_input",button:void 0,$button:void 0,button_id:"idpc_button",button_label:"Find my Address",button_class:"",button_disabled_message:"Looking up postcode...",$dropdown:void 0,dropdown_id:"idpc_dropdown",dropdown_select_message:"Please select your address",dropdown_class:"",$error_message:void 0,error_message_id:"idpc_error_message",error_message_invalid_postcode:"Please check your postcode, it seems to be incorrect",error_message_not_found:"Your postcode could not be found. Please type in your address",error_message_address_not_found:"We could not find a match for your address. Please type in your address",error_message_default:"Sorry, we weren't able to get the address you were looking for. Please type your address manually",error_message_class:"",address_search:!1,last_lookup:"",disable_interval:1e3,debug_mode:!1,check_key:!1,remove_organisation:!1,onLoaded:void 0,onFailedCheck:void 0,onLookupSuccess:void 0,onLookupError:void 0,onAddressSelected:void 0};b.prototype.setupPostcodeInput=function(a){this.$context=a,this.setupInputField(),this.setupLookupButton()},b.prototype.setupInputField=function(){var b=this;return this.$input=a(this.input).length?a(this.input).first():a("<input />",{type:"text",id:this.input_id,value:this.input_label}).appendTo(this.$context).addClass(this.input_class).val(this.input_label).attr("style",this.input_muted_style).submit(function(){return!1}).keypress(function(a){13===a.which&&b.$button.trigger("click")}).focus(function(){b.$input.removeAttr("style").val("")}).blur(function(){b.$input.val()||(b.$input.val(b.input_label),b.$input.attr("style",b.input_muted_style))}),this.$input},b.prototype.setupLookupButton=function(){var b=this;return this.$button=a(this.button).length?a(this.button).first():a("<button />",{html:this.button_label,id:this.button_id,type:"button"}).appendTo(this.$context).addClass(this.button_class).attr("onclick","return false;").submit(function(){return!1}),this.$button.click(function(){var a=b.$input.val();return b.last_lookup!==a&&(b.last_lookup=a,b.clearAll(),b.disableLookup(),b.lookupPostcode(a)),!1}),this.$button},b.prototype.disableLookup=function(a){this.button||(a=a||this.button_disabled_message,this.$button.prop("disabled",!0).html(a))},b.prototype.enableLookup=function(){if(!this.button){var a=this;0===a.disable_interval?a.$button.prop("disabled",!1).html(a.button_label):setTimeout(function(){a.$button.prop("disabled",!1).html(a.button_label)},a.disable_interval)}},b.prototype.clearAll=function(){this.setDropDown(),this.setErrorMessage()},b.prototype.removeAll=function(){this.$context=null,a.each([this.$input,this.$button,this.$dropdown,this.$error_message],function(a,b){b&&b.remove()})},b.prototype.lookupPostcode=function(b){var c=this;return a.idealPostcodes.validatePostcodeFormat(b)?void a.idealPostcodes.lookupPostcode(b,c.api_key,function(a){c.response_code=a.code,c.response_message=a.message,c.result=a.result,c.enableLookup(),2e3===c.response_code?(c.last_lookup=b,c.setDropDown(c.result)):c.setErrorMessage(4040===c.response_code?c.error_message_not_found:c.debug_mode?"("+c.response_code+") "+c.response_message:c.error_message_default),c.onLookupSuccess&&c.onLookupSuccess.call(c,a)},function(){c.setErrorMessage("Unable to connect to server"),c.enableLookup(),c.onLookupError&&c.onLookupError.call(c)}):c.address_search?this.searchAddress({query:b}):(this.enableLookup(),c.setErrorMessage(this.error_message_invalid_postcode))},b.prototype.searchAddress=function(b){var c=this;a.idealPostcodes.lookupAddress(b,c.api_key,function(a){c.response_code=a.code,c.response_message=a.message,c.result=a.result,c.enableLookup(),2e3===c.response_code?(c.result.total>0?(c.last_lookup=b.query,c.setDropDown(c.result.hits,function(a){var b=[a.line_1];return""!==a.line_2&&b.push(a.line_2),b.push(a.post_town),b.push(a.postcode_outward),b.join(", ")})):c.setErrorMessage(c.error_message_address_not_found),c.onLookupSuccess&&c.onLookupSuccess.call(c,a)):c.setErrorMessage(c.debug_mode?"("+c.response_code+") "+c.response_message:c.error_message_default)},function(){c.setErrorMessage("Unable to connect to server"),c.enableLookup(),c.onLookupError&&c.onLookupError.call(c)})},b.prototype.setDropDown=function(b,c){var d=this;if(c=c||function(a){var b=[a.line_1];return""!==a.line_2&&b.push(a.line_2),b.join(" ")},this.$dropdown&&this.$dropdown.length&&(this.$dropdown.remove(),delete this.$dropdown),b){var e=a("<select />",{id:d.dropdown_id}).addClass(d.dropdown_class);a("<option />",{value:"ideal",text:d.dropdown_select_message}).appendTo(e);for(var g=b.length,h=0;g>h;h+=1)a("<option />",{value:h,text:c(b[h])}).appendTo(e);return e.appendTo(d.$context).change(function(){var c,e=a(this).val();e>=0&&(c=d.remove_organisation?f(b[e]):b[e],d.setAddressFields(c),d.onAddressSelected&&d.onAddressSelected.call(d,c))}),d.$dropdown=e,e}},b.prototype.setErrorMessage=function(b){return this.$error_message&&this.$error_message.length&&(this.$error_message.remove(),delete this.$error_message),b?(this.$error_message=a("<p />",{html:b,id:this.error_message_id}).addClass(this.error_message_class).appendTo(this.$context),this.$error_message):void 0},b.prototype.setAddressFields=function(a){a=a||{};for(var b in this.$output_fields)this.$output_fields[b].val(a[b]||"")};var f=function(a){return 0!==a.organisation_name.length&&a.line_1===a.organisation_name&&(a.line_1=a.line_2,a.line_2=a.line_3,a.line_3=""),a};a.idealPostcodes={defaults:function(){return e},keyCheckCache:d,validatePostcodeFormat:function(a){return!!a.match(/^[a-zA-Z0-9]{1,4}\s?\d[a-zA-Z]{2}$/)||!!a.match(/^id1/i)},lookupPostcode:function(b,c,d,f){var g=e.api_endpoint,h="postcodes",i=[g,h,b].join("/"),j={url:i,data:{api_key:c},dataType:"jsonp",timeout:5e3,success:d};f&&(j.error=f),a.ajax(j)},lookupAddress:function(b,c,d,f){var g=e.api_endpoint,h="addresses",i=[g,h].join("/"),j={url:i,data:{api_key:c,query:b.query},dataType:"jsonp",timeout:5e3,success:d};f&&(j.error=f),a.ajax(j)},checkKey:function(b,c,f){f=f||function(){};var g=d[b];if("boolean"==typeof g)return g?c():f();if("object"==typeof g)return d[b].success.push(c),void d[b].error.push(f);d[b]={success:[c],error:[f]};var h=e.api_endpoint,i="keys",j=[h,i,b].join("/"),k={url:j,dataType:"jsonp",timeout:5e3};k.success=function(c){if(c&&c.result&&c.result.available){var e=d[b].success;d[b]=!0,a.each(e,function(a,b){b.call(null,c)})}else{var f=d[b].error;d[b]=!1,a.each(f,function(a,b){b.call()})}},k.error=function(){var c=d[b].error;delete d[b],a.each(c,function(a,b){b.call()})},a.ajax(k)},clearAll:function(){for(var a=c.length,b=0;a>b;b+=1)c[b].removeAll()}},a.fn.setupPostcodeLookup=function(d){var e=this;if(0===e.length)return e;var f=function(){a.each(e,function(e,f){var g=new b(d);c.push(g),g.setupPostcodeInput(a(f))}),a.isFunction(d.onLoaded)&&d.onLoaded.call(e)},g=function(){a.isFunction(d.onFailedCheck)&&d.onFailedCheck.call(e)};return d.check_key?a.idealPostcodes.checkKey(d.api_key,f,g):f(),e}}(jQuery);